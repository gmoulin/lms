var debugCacheManifest=1;if(debugCacheManifest){var cacheStatusValues=[];cacheStatusValues[0]="uncached";cacheStatusValues[1]="idle";cacheStatusValues[2]="checking";cacheStatusValues[3]="downloading";cacheStatusValues[4]="updateready";cacheStatusValues[5]="obsolete";function logEvent(f){var b,a,c,d;b=(navigator.onLine)?"yes":"no";a=cacheStatusValues[cache.status];c=f.type;d="online: "+b;d+=", event: "+c;d+=", status: "+a;if(c=="error"&&navigator.onLine){d+=" (prolly a syntax error in manifest)"}console.log(d)}var cache=window.applicationCache;cache.addEventListener("cached",logEvent,false);cache.addEventListener("checking",logEvent,false);cache.addEventListener("downloading",logEvent,false);cache.addEventListener("error",logEvent,false);cache.addEventListener("noupdate",logEvent,false);cache.addEventListener("obsolete",logEvent,false);cache.addEventListener("progress",logEvent,false);cache.addEventListener("updateready",logEvent,false);window.applicationCache.addEventListener("updateready",function(){window.applicationCache.swapCache();window.location.reload();console.log("swap cache has been called")},false);setInterval(function(){cache.update()},10000)}var subDomains=["s1","s2"],useSubDomains=false;$(document).ready(function(){if(window.location.host=="lms.dev"||window.location.host=="lms"){useSubDomains=true;for(var a=0;a<subDomains.length;a++){subDomains[a]=window.location.protocol+"//"+subDomains[a]+"."+window.location.host+"/"}}if($.browser.mozilla){$("html").addClass("mozilla")}$("#ajax_loader").ajaxStart(function(){$("#ajax_loader").addClass("loading")}).ajaxStop(function(){$("#ajax_loader").removeClass("loading")}).ajaxError(function(f,g,e,d){if(g.responseText!=""){inform("Error requesting page "+e.url+", error : "+g.responseText,"error")}});window.addEventListener("hashchange",tabSwitch,false);tabSwitch();$("#editHide, #detailHide, #storageHide, #previewHide, #confirmHide").click();$(".spinbox:not(.spinbox-active)").spinbox({min:1,max:null,step:1,reset:0,});$(".add_another").click(function(g){g.preventDefault();if(!$(this).is("button")){return}var e=$(this).siblings("ol"),d=$(".anotherInfo:last",e).clone(true),f=$("input",d).attr("id").split("_"),h=parseInt(f[1]);d.children("input").attr("id",function(j,i){return i.replace(new RegExp(h),h+1)}).attr("name",function(j,i){return i.replace(new RegExp(h),h+1)}).val("").siblings("label").attr("for",$("input",d).attr("id"));e.append(d)});$(".delete_another").click(function(d){d.preventDefault();if(!$(this).is("button")){return}if($(this).closest("ol").children("li").length>1){$(this).closest(".anotherInfo").remove()}else{$(this).siblings("input").val("")}});$(".filterForm").each(function(){var f=$(this),d=f.children(".sortTypeField");if(d.length){var e=d.val();if(e==""){e=d.val(0).val()}if(e%2==0){f.find(".listSort a[href="+e+"]").removeClass("both desc").addClass("asc")}else{f.find(".listSort a[href="+e+"]").removeClass("both asc").addClass("desc")}}}).delegate(".filterFormSwitch","click",function(f){f.preventDefault();if(!$(this).is("a")){return}var d=$(this).closest(".listFilter").toggleClass("deploy");if(d.hasClass("deploy")){d.find("datalist, select").loadList()}}).delegate(".search","click",function(d){d.preventDefault();getList(1)}).delegate(".cancel","click",function(d){d.preventDefault();$(this).closest(".filterForm").find(":input").val("");getList(0)}).delegate(".sort","click",function(i){i.preventDefault();var g=$(this);if(!g.is("a")){return}var j=g.attr("class"),d=g.closest(".filterForm"),f=g.attr("href");$(".sort",d).removeClass("asc").removeClass("desc").addClass("both");g.attr("class",j);if(g.hasClass("both")){g.toggleClass("both asc")}else{if(g.hasClass("asc")){g.toggleClass("asc desc");f++}else{if(g.hasClass("desc")){g.toggleClass("desc both");$(".sort:first",d).click();return}}}d.children(".sortTypeField").val(f);getList(1)});$(".add").click(function(i){i.preventDefault();if(!$(this).is("button")){return}var d=$(this).attr("rel"),g=$("#manage_"+d),f="",h="",j="Enregistrer ";
if(d=="book"){another="bookAuthors";f="bookAuthor";h="author"}else{if(d=="album"){another="albumBands";f="albumBand";h="band"}else{if(d=="movie"){another="movieArtists";f="movieArtist";h="artist"}}}if(f!=""){$("#"+another).children(".anotherInfo:gt(0)").remove();$("#"+another).find("input").attr("id",f+"_1").attr("name",h+"_1").siblings("label").attr("for",f+"_1")}g.find(":input").val("").change();g.find(".coverStatus").html(function(){var e="Déposer ";d=="book"||d=="album"?e+="la couverture":e+="l'affiche"});$("#editPreview").empty();$("#"+d+"Action").val("add");hideInform();d=="book"||d=="movie"||d=="band"||d=="storage"?j+=" le nouveau ":d=="album"||d=="author"||d=="artist"?j+=" le nouvel ":j+=" la nouvelle ";if(d=="book"){j+="livre"}else{if(d=="movie"){j+="film"}else{if(d=="album"){j+="album"}else{if(d=="saga"){j+="saga"}else{if(d=="author"){j+="auteur"}else{if(d=="artist"){j+="artiste"}else{if(d=="band"){j+="groupe"}else{if(d=="storage"){j="rangement"}}}}}}}}g.appendTo($("#editForm .formWrapper").empty());$("#editForm .formTitle").html(j);$("#formSubmit").data("save_clicked",0).attr("rel","add").text("Enregistrer");$("#editShow").attr("rel",d).click()});$(".update").live("click",function(g){g.preventDefault();if(!$(this).is("a")){return}var i=$(this),m=i.attr("rel"),h=m.charAt(0).toUpperCase()+m.substr(1),j=$("#manage_"+m),k="",l="Modifier les informations ",f=$("#editPreview").empty();if(m=="book"){k="bookAuthors"}else{if(m=="movie"){k="movieArtists"}else{if(m=="album"){k="albumBands"}}}if(k!=""){$("#"+k).children(".anotherInfo:gt(0)").remove()}j.find(":input").val("");j.find(".coverStatus").html(function(){return"Déposer "+(m=="movie"?"l'affiche":"la couverture")});$("#"+m+"Action").val("update");hideInform();if(m=="book"){l+="du livre"}else{if(m=="movie"){l+="du film"}else{if(m=="album"){l+="du l'album"}else{if(m=="saga"){l+="de la saga"}else{if(m=="author"){l+="de l'auteur"}else{if(m=="artist"){l+="de l'artiste"}else{if(m=="band"){l+="du groupe"}else{if(m=="storage"){l="du rangement"}}}}}}}}j.appendTo($("#editForm .formWrapper").empty());$("#editForm .formTitle").html(l);$("#formSubmit").data("save_clicked",0).attr("rel","update").text("Enregistrer");$("#editShow").attr("rel",m).click();var d=$("<textarea>");$.post("ajax/manage"+h+".php","action=get&id="+i.attr("href"),function(e){switch(m){case"book":$("#bookID").val(e.bookID);$("#bookTitle").val(d.html(e.bookTitle).val()).change();$("#bookSize").val(e.bookSize);$("#bookCover").val(e.bookCover);$("<img>",{src:"image.php?cover=book&id="+e.bookID}).appendTo(f);$("#bookSagaTitle").val(d.html(e.sagaTitle).val()).change();$("#bookSagaPosition").val(e.bookSagaPosition);$("#bookStorage").data("selectedId",e.storageID);var n=1;$.each(e.authors,function(o,p){if(n>1){$("#another_author").click()}$("#bookAuthor_"+n).val(d.html(p.authorFirstName+" "+p.authorLastName).val());n++});break;case"movie":$("#movieID").val(e.movieID);$("#movieTitle").val(d.html(e.movieTitle).val()).change();$("#movieGenre").val(d.html(e.movieGenre).val());$("#movieMediaType").val(d.html(e.movieMediaType).val());$("#movieLength").val(e.movieLength);$("#movieCover").val(e.movieCover);$("<img>",{src:"image.php?cover=movie&id="+e.movieID}).appendTo(f);$("#movieSagaTitle").val(d.html(e.sagaTitle).val()).change();$("#movieSagaPosition").val(e.movieSagaPosition);$("#movieStorage").data("selectedId",e.storageID);var n=1;$.each(e.artists,function(p,o){if(n>1){$("#another_artist").click()}$("#movieArtist_"+n).val(d.html(o.artistFirstName+" "+o.artistLastName).val());n++});break;case"album":$("#albumID").val(e.albumID);$("#albumTitle").val(d.html(e.albumTitle).val()).change();$("#albumType").val(e.albumType);$("#albumCover").val(e.albumCover);$("<img>",{src:"image.php?cover=album&id="+e.albumID}).appendTo(f);$("#albumStorage").data("selectedId",e.storageID);var n=1;$.each(e.bands,function(o,p){if(n>1){$("#another_band").click()}$("#albumBand_"+n).val(d.html(p.bandName).val());n++});break;case"author":$("#authorID").val(e.authorID);
$("#authorFirstName").val(d.html(e.authorFirstName).val());$("#authorLastName").val(d.html(e.authorLastName).val());$("#authorWebSite").val(e.authorWebSite);$("#authorSearchURL").val(e.authorSearchURL);break;case"band":$("#bandID").val(e.bandID);$("#bandName").val(d.html(e.bandName).val()).change();$("#bandGenre").val(d.html(e.bandGenre).val());$("#bandWebSite").val(e.bandWebSite);break;case"artist":$("#artistID").val(e.artistID);$("#artistFirstName").val(d.html(e.artistFirstName).val());$("#artistLastName").val(d.html(e.artistLastName).val());break;case"saga":$("#sagaID").val(e.sagaID);$("#sagaTitle").val(d.html(e.sagaTitle).val());$("#sagaSearchURL").val(e.sagaSearchURL);break;case"storage":$("#storageID").val(e.storageID);$("#storageRoom").val(e.storageRoom);$("#storageType").val(e.storageType);$("#storageColumn").val(e.storageColumn);$("#storageLine").val(e.storageLine);$("<img>",{src:"image.php?cover=storage&id="+e.storageID}).appendTo(f);break}})});$(".delete").live("click",function(j){j.preventDefault();if(!$(this).is("a")){return}hideInform();var i=$(this),l=i.attr("href"),d=i.attr("rel"),h=d.charAt(0).toUpperCase()+d.substr(1),k="Etes-vous sûr de vouloir supprimer ",g=$("#confirmForm .formWrapper"),f=$("#confirmSubmit").data("save_clicked",0);if(d=="book"){k+="ce livre ?"}else{if(d=="album"){k+="cet album ?"}else{if(d=="movie"){k+="ce film ?"}else{if(d=="saga"){k+="cette saga ?<br />Tous les livres et films listés ci-dessous seront également supprimés !"}else{if(d=="author"){k+="cet auteur ?<br />Tous les livres listés ci-dessous seront également supprimés !"}else{if(d=="artist"){k+="cet artiste ?<br />Tous les films listés ci-dessous seront également supprimés !"}else{if(d=="band"){k+="ce groupe ?<br />Tous les albums listés ci-dessous seront également supprimés !"}else{if(d=="storage"){k+="ce rangement ?"}else{if(d=="loan"){k+="ce prêt ?"}}}}}}}}}g.html($("<span>",{"class":"confirmation"}).append(k));f.data("save_clicked",0);$("#confirmShow").attr("rel",d).data("id",l).click();if(d=="saga"||d=="author"||d=="artist"||d=="band"){$.ajax({url:"ajax/manage"+h+".php",type:"POST",data:"action=impact&id="+l,async:false,dataType:"html",success:function(e){g.append(e)}})}if(d=="storage"){$.ajax({url:"ajax/manage"+h+".php",type:"POST",data:"action=impact&id="+l,async:false,dataType:"html",success:function(e){g.append(e);f.prop({disabled:true})}})}});$("#relocate").live("click",function(f){f.preventDefault();if(!$(this).is("button")){return}hideInform();if($("#storageList").val()==""){formErrors([["storageList","Le nouveau rangement est requis.","required"]])}else{var d=$("#impactStorage");$.post("ajax/manageStorage.php","action=relocate&"+$.param(d.find("input:checked, select"),true),function(e){if(e=="ok"){inform("Nouvelle allocation effectuée","success");d.find(":input:checked").parent().remove();if(!d.find("input").length){d.remove();$("#confirmSubmit").removeProp("disabled")}}})}});$(".move").live("click",function(i){i.preventDefault();if(!$(this).is("a")){return}hideInform();var h=$(this),k=h.attr("href"),d=h.attr("rel"),g=d.charAt(0).toUpperCase()+d.substr(1),j="Etes-vous sûr de vouloir changer le rangement de cette saga ?",f=$("#editForm .formWrapper").empty();$("#editForm .formTitle").html("Modification du rangement");$("#formSubmit").data("save_clicked",0);$("#editPreview").empty();$.ajax({url:"ajax/manage"+g+".php",type:"POST",data:"action=moveImpact&id="+k,async:false,dataType:"html",success:function(e){f.append(e)}});$("#editShow").attr("rel","move").data("id",k).click()});$(".addLoan").live("click",function(h){h.preventDefault();if(!$(this).is("a")){return}var g=$(this),f=$("#manage_loan"),i="Enregistrer le nouveau prêt",d=$("#editForm");f.find(":input").val("");$("#editPreview").empty();$("#loanAction").val("add");$("#loanFor").val(g.attr("rel"));$("#itemID").val(g.attr("href"));hideInform();f.appendTo(d.find(".formWrapper").empty());d.find(".formTitle").html(i);$("#formSubmit").data("save_clicked",0).attr("rel","add").text("Enregistrer");
$("#editShow").attr("rel","loan").click()});$(".list").delegate(".storage","click",function(h){h.preventDefault();var g=$(this);if(!g.is("a")){return}if(g.closest("#list_storage").length){var d=$("#detailBox"),f=$("#detail");d.data("link",g.attr("href")).data("tab",$("#nav").data("activeTab"));f.html(g.parent().find(".block").clone(true));$("#detailShow").click();$("#storageImg").removeAttr("src").attr("src",g.attr("href"));$("#storageShow").click()}else{if($("#storageShow:checked").length){$("#storageHide").click()}else{$("#storageImg").attr("src",g.attr("href"));$("#storageShow").click()}}}).delegate(".detail","click",function(h){h.preventDefault();var g=$(this);if(!g.is("a")){return}var d=$("#detailBox"),f=$("#detail"),i=f.find(".close").clone();d.data("link",g.attr("href")).data("tab",$("#nav").data("activeTab"));$("#storageHide").attr("checked","checked");f.html(g.parent().find(".block").clone(true).append(i));$("#detailShow").click()});$(".filter").live("click",function(h){h.preventDefault();var g=$(this);if(!g.is("a")){return}var d=g.attr("rel");if(!d){return}d=d.charAt(0).toUpperCase()+d.substr(1);var f=$("#nav").data("activeTab");$("#"+f+d+"Filter").val(g.attr("href"));$("#"+f+"_filter .listFilter").addClass("deploy");getList(1);$("#detailHide, #editHide, #previewHide, #storageHide, #confirmHide").prop({checked:true})});$(".form").each(function(){this.addEventListener("invalid",checkField,true);this.addEventListener("blur",checkField,true);this.addEventListener("input",checkField,true)}).submit(function(d){d.preventDefault();$("#formSubmit").click()});$("#formSubmit").click(function(i){i.preventDefault();var h=$(this),f=h.closest(".wrapper").find(".form");if(!f.length){return}var d=$("#editBox .form").attr("rel"),g=d.charAt(0).toUpperCase()+d.substr(1);if(h.data("save_clicked")!=1){h.data("save_clicked",1);hideInform();if(d!="move"){$.ajax({url:"ajax/manage"+g+".php",data:f.find(":input").serialize(),type:"POST",dataType:"json",complete:function(){h.data("save_clicked",0)},success:function(e){if(e=="ok"){var j=$("#confirmForm");$("#editHide").click();if($("#confirmShow:checked").length){if(d=="saga"||d=="author"||d=="artist"||d=="band"){$.ajax({url:"ajax/manage"+g+".php",type:"POST",data:"action=impact&id="+id,async:false,dataType:"html",success:function(k){j.find(".impact").remove();j.find(".formWrapper").append(k)}})}else{if(d=="storage"){$.ajax({url:"ajax/manage"+g+".php",type:"POST",data:"action=impact&id="+id,async:false,dataType:"html",success:function(k){$("#impactStorage").remove();j.find(".formWrapper").append(k);$("#confirmSubmit").prop({disabled:true})}})}}}else{getList(2)}inform(($("#"+d+"Action").val()=="add"?"Ajout effectué":"Mise à jour effectuée"),"success")}else{inform("Erreur durant la validation du formulaire","error");formErrors(e)}}})}else{$.post("ajax/manageSaga.php","action=move&id="+$("#editShow").data("id")+"&"+$("#moveSaga").serialize(),function(e){if(e=="ok"){getList(2);inform("Modification effectuée","success");$("#editHide").click()}else{inform("Erreur durant la modification","error");formErrors(e)}})}}});$("#formCancel").click(function(d){d.preventDefault();$("#editHide").click()});$("#confirmSubmit").click(function(i){i.preventDefault();var h=$(this),f=h.closest(".wrapper"),d=$("#confirmShow").attr("rel"),g=d.charAt(0).toUpperCase()+d.substr(1);if(h.data("save_clicked")!=1){h.data("save_clicked",1);hideInform();$.post("ajax/manage"+g+".php","action=delete&id="+$("#confirmShow").data("id"),function(e){if(e=="ok"){getList(2);inform("Suppression effectuée","success");$("#confirmHide").click()}else{inform("Erreur durant la suppression","error");formErrors(e)}})}});$("#confirmCancel").click(function(d){d.preventDefault();$("#confirmHide").click()});$("#editHide").click(function(g){var f=$("#editBox");if(f.find(".form").length){var d=f.find(".form").attr("rel");if(f.find(".coverStatus").length){$("html, #drop_overlay").unbind("dragenter").unbind("dragover").unbind("dragleave").unbind("dragend");
$("html").get(0).removeEventListener("drop",dropCover,true)}$("#manage_"+d).appendTo($("body"))}});$("#editShow").click(function(h){var d=$(this).attr("rel"),g=d.charAt(0).toUpperCase()+d.substr(1),f=$("#editBox .formWrapper");if($("img","#editPreview").length){$("#previewShow").click()}else{$("#previewHide").click()}f.find(":input, .coverStatus").removeClass("required valid error upload");if(f.find(".coverStatus").length){$("html, #drop_overlay").bind("dragenter",dragEnter).bind("dragover",dragOver).bind("dragleave",dragLeave);$("html").get(0).addEventListener("drop",dropCover,true)}if($("#editPreview").find("img").length){$("#previewShow").prop({checked:true})}$("datalist, select",f).loadList()});$(".close").live("click",function(d){d.preventDefault();if(!$(this).is("button")){return}var f=$(this).closest(".box").attr("id");if(f=="editBox"){$("#editHide, #previewHide").click()}else{if(f=="detailBox"){$("#detailHide, #storageHide").click()}else{if(f=="confirmBox"){$("#confirmHide").click()}else{$("#detailHide, #editHide, #previewHide, #storageHide, #confirmHide").click()}}}});$("#editShow, #detailShow, #storageShow, #previewShow, #confirmShow").click(function(d){$(document).unbind("keydown")});$("#editHide, #detailHide, #storageHide, #previewHide, #confirmHide").click(function(d){addShortcutsSupport()});$("#nav a").click(function(f){var d=$(this).attr("href").substr(1);if(d==$("#nav").data("activeTab")){f.preventDefault();getList(0)}});$("#helpSwitch").click(function(d){d.preventDefault();$("#help").toggleClass("deploy")});addShortcutsSupport();addEscapeSupport();$("a.button").live("click",function(d){$(this).blur()});$(".listDisplaySwitch a").click(function(h){h.preventDefault();var g=$(this),i=g.closest(".listDisplaySwitch").find("a").map(function(){return this.rel}).get().join(" "),d=g.closest(".list"),f=g.attr("rel");g.addClass("disabled").siblings().removeClass("disabled");$("#holder").removeClass(i).addClass(f);d.removeClass(i).addClass(f).children(".listContent").render("relayout")});$(".externalLink","#list_band").live("click",function(f){$.post("ajax/manageBand.php",{action:"updateLastCheckDate",id:$(this).attr("rel")});if($("#bandSortType").val()>=2){var g=$(this).closest("li");var d=g.parent();if($("#bandSortType").val()==2){g.appendTo(d)}else{g.prependTo(d)}}});var b=$("<a>",{"class":"button icon externalLink small quickLink",target:"_blank","data-icon":"/"});$("#movieTitle").change(function(){$(this).siblings("label").html(function(){return $(this).text()}).append($(this).val()!=""?b.clone().attr("title","Rechercher sur Google Image").attr("href","http://www.google.com/images?q="+$(this).val()+" movie"):"").append($(this).val()!=""?b.clone().attr("title","Rechercher sur IMDB").attr("href","http://www.imdb.com/find?s=all&q="+$(this).val()):"")});$("#bookTitle").change(function(){$(this).siblings("label").html(function(){return $(this).text()}).append($(this).val()!=""?b.clone().attr("title","Rechercher sur Google Image").attr("href","http://www.google.com/images?q="+$(this).val()+" book"):"").append($(this).val()!=""?b.clone().attr("title","Rechercher sur Fantastic Fiction").attr("href","http://www.fantasticfiction.co.uk/search/?searchfor=book&keywords="+$(this).val()):"")});$("#albumTitle").change(function(){$(this).siblings("label").html(function(){return $(this).text()}).append($(this).val()!=""?b.clone().attr("title","Rechercher sur Google Image").attr("href","http://www.google.com/images?q="+$(this).val()+" music album"):"")});$("#bandName").change(function(){$(this).siblings("label").html(function(){return $(this).text()}).append($(this).val()!=""?b.clone().attr("title","Rechercher sur Wikipedia").attr("href","http://en.wikipedia.org/w/index.php?search="+$(this).val()):"")});$("#bookSagaTitle, #movieSagaTitle").change(function(){var h=$(this);var f=h.closest(".form");var d=f.attr("rel");var g=d.charAt(0).toUpperCase()+d.substr(1);var e=h.siblings("datalist");var i=$("<textarea>");h.siblings("label").html(function(){return $(this).text()
});if(h.val()!=""&&$('option[value="'+h.val()+'"]',e).length){$.post("ajax/manageSaga.php","action=getByTitleFor"+g+"&title="+h.val(),function(j){if(!$.isEmptyObject(j)){if(j.sagaSearchURL!=""&&j.sagaSearchURL!=null){h.siblings("label").append(b.clone().attr("title","Détail de cette saga sur internet").attr("href",i.html(j.sagaSearchURL).val()))}if($("#"+d+"Action").val()=="add"){$("#"+d+"SagaPosition").val(j.position).trigger("blur");$("#"+d+"Storage").val(j.storageID).trigger("blur");if(d=="book"){var k=1;$(".anotherInfo:gt(0)","#bookAuthors").remove();$.each(j.authors,function(m,l){if(k>1){$("#another_author").click()}$("#bookAuthor_"+k).val(i.html(l).val()).trigger("blur");k++})}else{if(d=="movie"){var k=1;$(".anotherInfo:gt(0)","#movieArtists").remove();$.each(j.artists,function(m,l){if(k>1){$("#another_artist").click()}$("#movieArtist_"+k).val(i.html(l).val()).trigger("blur");k++})}}}$("#"+d+"SagaPosition").focus().select()}})}});var c=null;$(window).resize(function(){if(c){clearTimeout(c)}c=window.setTimeout(function(){$("#list_"+$("#nav").data("activeTab")).children(".listContent").render("relayout")},100)})});function tabSwitch(){var a=window.location.hash.substr(1)||$(".tab:first").attr("id");$("#nav a").removeClass("active");$("a[href$="+a+"]","#nav").addClass("active");if($("#"+a).length){window.location.hash="#"+a;$("#nav").data("activeTab",a);$("#nav").data("updating",0);getList(0)}}$.fn.loadList=function(){return this.each(function(){var f=$(this),a=f.attr("id"),g=$("<textarea>"),c,b=0;try{c=localStorage.getObject(a);if(c){b=c.lastModified}}catch(d){alert(d)}$.ajax("ajax/loadList.php",{data:"field="+f.attr("id"),dataType:"json",headers:{"If-Modified-Since":b},success:function(j,l,i){if(i.status==200){try{b=i.getResponseHeader("Last-Modified");localStorage.setObject(a,{lastModified:b,data:j})}catch(k){alert(k)}}else{j=c.data;if(f.find("option:gt(0)").length){return}}if(f.is("datalist")){f.empty()}else{var h=false;if(f.attr("id").search(/Filter/)!=-1&&f.val()!=""){f.data("sav",f.val());h=true}f.find("option:gt(0)").remove()}$.each(j,function(e,m){m.value=g.html(m.value).val();$("<option>",{value:(m.id?m.id:m.value),text:m.value}).appendTo(f)});if(h){f.val(list.data("sav"))}if(f.data("selectedId")){f.val(f.data("selectedId"));f.removeData("selectedId")}}})})};String.prototype.urlify=function(){var f=this,b="ÀÁÂÃÄÅàáâãäåÒÓÔÕÕÖØòóôõöøÈÉÊËèéêëðÇçÐÌÍÎÏìíîïÙÚÛÜùúûüÑñŠšŸÿýŽž ",e=["A","A","A","A","A","A","a","a","a","a","a","a","O","O","O","O","O","O","O","o","o","o","o","o","o","E","E","E","E","e","e","e","e","e","C","c","D","I","I","I","I","i","i","i","i","U","U","U","U","u","u","u","u","N","n","S","s","Y","y","y","Z","z",""],a=[];f=f.split("");len=f.length;for(var d=0;d<len;d++){var c=b.indexOf(f[d]);if(c!=-1){a[d]=e[c]}else{a[d]=f[d]}}return a.join("")};function getFullUrl(a,b){if(useSubDomains){return subDomains[b%subDomains.length]+a+b}return a+b}Storage.prototype.setObject=function(a,b){this.setItem(a,JSON.stringify(b))};Storage.prototype.getObject=function(a){return this.getItem(a)&&JSON.parse(this.getItem(a))};function isStorageChanged(b){var c=this.data.list[b],a=c.storageColumn!=null&&b>0&&(this.data.list[b-1].storageRoom!=c.storageRoom||this.data.list[b-1].storageType!=c.storageType);if(a){this.data.currentStorageURL="storage/"+c.storageRoom.urlify()+"_"+c.storageType.urlify()+".png"}this.data.list[b].storageURL="storage/"+c.storageRoom.urlify()+"_"+c.storageType.urlify()+(c.storageColumn!=null||c.storageLine!=null?"_"+c.storageColumn+c.storageLine:"")+".png";return a}function addEscapeSupport(){$("html").unbind("keypress").keypress(function(a){if(a.keyCode==27){if($("#inform span:visible").length){hideInform()}else{if($("#help").hasClass("deploy")){$(".help").click()}else{if($("#drop_overlay:visible").length){$("#drop_overlay").hide()}else{if($("#storageShow:checked").length){$("#storageHide").click()}else{if($("#previewShow:checked").length){$("#previewHide").click()}else{if($("#editShow:checked").length){$("#editHide").click()
}else{if($("#confirmShow:checked").length){$("#confirmHide").click()}else{if($("#detailShow:checked").length){$("#detailHide").click()}}}}}}}}}})}function addShortcutsSupport(){$(document).unbind("keydown").keydown(function(f){if(f.which==65){$(".add","#"+$("#nav").data("activeTab")).click()}else{if(f.which==70){$(".filterFormSwitch","#"+$("#nav").data("activeTab")).click()}else{if(f.which==86){var b=$(".listDisplaySwitch a","#"+$("#nav").data("activeTab"));if(!b.length){return}var d=$(".listDisplaySwitch","#"+$("#nav").data("activeTab")).find(".disabled");if(!d.length){return}var a=b.index(d);a++;if(a==b.length){a=0}b.eq(a).click()}else{var a=parseInt(String.fromCharCode(f.which));if(!isNaN(a)){if($(".tab").eq(a-1).length){var c=$(".tab").eq(a-1).attr("id");if($("#nav").data("activeTab")==c){getList(0)}else{window.location.hash="#"+c}}}}}}})}function formErrors(a){$.each(a,function(c,b){$("#"+b[0]).addClass(b[2]).siblings(".tip").remove();$("#"+b[0]).parent().append($("<span>",{"class":"tip",text:b[1]}))})}function inform(b,a){$("#inform span").addClass(a).text(b).parent().show()}function hideInform(){$("#inform span").attr("class","").empty().parent().hide()}var dropTimeout=0;function dragEnter(a){a.preventDefault();$("#drop_overlay").show();if(a.dataTransfer){a.dataTransfer.effectAllowed="copy";a.dataTransfer.dropEffect="copy"}else{if(a.originalEvent.dataTransfer){a.originalEvent.dataTransfer.effectAllowed="copy";a.originalEvent.dataTransfer.dropEffect="copy"}}dropTimeout=window.setTimeout(function(){$("#drop_overlay").hide()},3000)}function dragOver(a){a.preventDefault();if($("#drop_overlay:hidden").length){$("#drop_overlay").show()}clearTimeout(dropTimeout);dropTimeout=window.setTimeout(function(){$("#drop_overlay").hide()},3000)}function dragLeave(a){a.stopPropagation()}function dropCover(f){f.preventDefault();$("#drop_overlay").hide();var g=$("#editBox").find(".form"),a=g.attr("rel"),b=$(".coverStatus",g).removeClass("required valid error upload");if(!b.data("oldText")){b.data("oldText",b.html())}var e=f.dataTransfer;var d=e.files;if(d.length==0&&e.types.contains("application/x-moz-file-promise-url")){hideInform();url=e.getData("application/x-moz-file-promise-url");b.addClass("upload");$.ajax({url:"ajax/manageCover.php?rel="+a,data:"url="+e.getData("application/x-moz-file-promise-url"),complete:function(h){b.removeClass("upload")},success:function(h){var i=new Date().getTime();$("#editPreview").empty().append($("<img>",{src:"covers/"+h+"?"+i}));$("#"+a+"Cover").val(h);b.html(b.data("oldText")).addClass("valid");if(!$("#previewShow:checked").length){$("#previewShow").click()}},error:function(h,j,i){b.html(i).addClass("error")}});return}if(d.length>1){formErrors([[a+"CoverStatus","Une seule image est permise, seule la première est prise en compte.","warning"]])}var c=d[0];if(c.type.match(/image.(jpe?g|png|gif)/)){upload(c,a,b)}else{formErrors([[a+"CoverStatus","Seule les images .jpg, .jpeg, .png or .gif sont permises.","error"]])}}function upload(d,b,c){if(window.FileReader){hideInform();var a=new FileReader();if(typeof(a.addEventListener)==="function"){a.addEventListener("loadend",function(){var e=new XMLHttpRequest();e.open("POST","ajax/manageCover.php?up=true&rel="+b,true);e.setRequestHeader("UP-NAME","upload");e.setRequestHeader("UP-FILENAME",d.name);e.setRequestHeader("UP-SIZE",d.size);e.setRequestHeader("UP-TYPE",d.type);e.send(window.btoa(a.result));c.addClass("upload");e.onreadystatechange=function(){if(e.readyState==4){c.removeClass("upload");if(e.status==200){c.html(c.data("oldText")).addClass("valid");var f=new Date().getTime();$("#editPreview").empty().append($("<img>",{src:"covers/"+d.name+"?"+f}));$("#"+b+"Cover").val(d.name);if(!$("#previewShow:checked").length){$("#previewShow").click()}}else{c.html(e.responseText).addClass("error")}}}},true);a.addEventListener("error",function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:c.html("Fichier non trouvé!").removeClass("upload").addClass("error");
break;case e.target.error.NOT_READABLE_ERR:c.html("Fichier non lisible!").removeClass("upload").addClass("error");break;case e.target.error.ABORT_ERR:break;default:c.html("Erreur de lecture.").removeClass("upload").addClass("error")}},true);a.addEventListener("progress",function(e){if(e.lengthComputable){c.html("Chargement : "+Math.round((e.loaded*100)/e.total)+"%")}},true);a.addEventListener("loadProgress",function(e){if(e.lengthComputable){c.html("Chargement : "+Math.round((e.loaded*100)/e.total)+"%")}},true)}else{a.onload=function(){var e=new XMLHttpRequest();e.open("POST","ajax/manageCover.php?up=true&rel="+b,true);e.setRequestHeader("UP-NAME","upload");e.setRequestHeader("UP-FILENAME",d.name);e.setRequestHeader("UP-SIZE",d.size);e.setRequestHeader("UP-TYPE",d.type);e.send(window.btoa(a.result));c.addClass("upload");e.onload=function(){if(e.readyState==4){c.removeClass("upload");if(e.status==200){c.html(c.data("oldText")).addClass("valid");var f=new Date().getTime();$("#editPreview").empty().append($("<img>",{src:"covers/"+d.name+"?"+f}));$("#"+b+"Cover").val(d.name);if(!$("#previewShow:checked").length){$("#previewShow").click()}}else{c.html(e.responseText).addClass("error")}}}}}a.readAsBinaryString(d)}else{c.removeClass("upload").addClass("error");inform("upload non supporté","error")}}function checkField(b){var a=$(b.target);if(a[0].validity){if(a[0].validity.valid){if(a.val()!=""){a.removeClass("required error upload").addClass("valid")}}else{if(b.type!="input"){if(a[0].validity.valueMissing){a.removeClass("error valid upload").addClass("required")}else{a.removeClass("required valid upload").addClass("error")}}else{if(a[0].validity.valueMissing){a.removeClass("required valid error upload")}}}}}var didScroll=false,interval=null;function getList(e){hideInform();var a=$("#nav");if(!a.length){return}if(a.data("updating")!=1){a.data("updating",1);var d=$("#nav").data("activeTab");if(d===undefined){return}var c=d.charAt(0).toUpperCase()+d.substr(1),b=$("#list_"+d),g=$("#"+d+"_filter"),f=$("body");if(!$("#"+d+"PaginateTemplate").data("tmpl")){$("#"+d+"PaginateTemplate").template(d+"Paginate")}if(!$("#"+d+"ListTemplate").data("tmpl")){$("#"+d+"ListTemplate").template(d+"List")}f.css("cursor","progress");$.ajax({url:"ajax/manage"+c+".php",data:"action="+(e==3?"more":"list&type="+e+"&"+$(":input",g).serialize()),type:"POST",dataType:"json",complete:function(){a.data("updating",0);f.css("cursor","")},success:function(n){if(e==0){$(window).scrollTop(0)}if(e!=3){b.children(".paginate, .listContent").remove();$.tmpl(d+"Paginate",n).appendTo(b);$.tmpl(d+"List",n).appendTo(b);if($.browser.mozilla&&!b.hasClass("hasCovers")&&!b.hasClass("rendered")){}b.children(".listContent").render();var m=b.children(".paginate");if(m.hasClass("begin")){if(interval){clearInterval(interval)}$(window).unbind("scroll").scroll(function(i){didScroll=true});interval=setInterval(function(){if(didScroll){didScroll=false;var i=b.find(".item:last");if(i.length&&!$("#detailShow:checked, #editShow:checked").length&&($(window).scrollTop()+$(window).height()+50)>=i.offset().top){getList(3)}}},250)}else{if(m.hasClass("end")){$(window).unbind("scroll");clearInterval(interval)}}if(e==2&&$("#detailShow:checked").length){$("#detailHide").click();var j=$("#detailBox");if(j.data("link")&&j.data("tab")==d){var o=j.data("link");var p=new Date().getTime();if(d!="storage"){var k=b.find(".detail[href="+o+"]")}else{var k=b.find(".storage[href="+o+"]")}var p=new Date().getTime(),q=k.parent().find(".cover"),h=q.attr("src")+"&ts="+p;q.removeAttr("src").attr("src",h);k.parent().css("background-image","url("+h+")");k.click()}}g.children(".listFilter.deploy").find("datalist, select").loadList()}else{b.children(".paginate").remove();$.tmpl(d+"Paginate",n).appendTo(b);var l=$.tmpl(d+"List",n);b.children(".listContent").append(l.children()).render("relayout");if(b.children(".paginate").hasClass("end")){$(window).unbind("scroll")}}}})}};