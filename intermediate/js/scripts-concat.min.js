(function(a){var r=a.fn.domManip,d="_tmplitem",q=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,b={},f={},e,p={key:0,data:{}},h=0,c=0,l=[];function g(e,d,g,i){var c={data:i||(d?d.data:{}),_wrap:d?d._wrap:null,tmpl:null,parent:d||null,nodes:[],calls:u,nest:w,wrap:x,html:v,update:t};e&&a.extend(c,e,{nodes:[],parent:d});if(g){c.tmpl=g;c._ctnt=c._ctnt||c.tmpl(a,c);c.key=++h;(l.length?f:b)[h]=c}return c}a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(f,d){a.fn[f]=function(n){var g=[],i=a(n),k,h,m,l,j=this.length===1&&this[0].parentNode;e=b||{};if(j&&j.nodeType===11&&j.childNodes.length===1&&i.length===1){i[d](this[0]);g=this}else{for(h=0,m=i.length;h<m;h++){c=h;k=(h>0?this.clone(true):this).get();a.fn[d].apply(a(i[h]),k);g=g.concat(k)}c=0;g=this.pushStack(g,f,i.selector)}l=e;e=null;a.tmpl.complete(l);return g}});a.fn.extend({tmpl:function(d,c,b){return a.tmpl(this[0],d,c,b)},tmplItem:function(){return a.tmplItem(this[0])},template:function(b){return a.template(b,this[0])},domManip:function(d,l,j){if(d[0]&&d[0].nodeType){var f=a.makeArray(arguments),g=d.length,i=0,h;while(i<g&&!(h=a.data(d[i++],"tmplItem")));if(g>1)f[0]=[a.makeArray(d)];if(h&&c)f[2]=function(b){a.tmpl.afterManip(this,b,j)};r.apply(this,f)}else r.apply(this,arguments);c=0;!e&&a.tmpl.complete(b);return this}});a.extend({tmpl:function(d,h,e,c){var j,k=!c;if(k){c=p;d=a.template[d]||a.template(null,d);f={}}else if(!d){d=c.tmpl;b[c.key]=c;c.nodes=[];c.wrapped&&n(c,c.wrapped);return a(i(c,null,c.tmpl(a,c)))}if(!d)return[];if(typeof h==="function")h=h.call(c||{});e&&e.wrapped&&n(e,e.wrapped);j=a.isArray(h)?a.map(h,function(a){return a?g(e,c,d,a):null}):[g(e,c,d,h)];return k?a(i(c,null,j)):j},tmplItem:function(b){var c;if(b instanceof a)b=b[0];while(b&&b.nodeType===1&&!(c=a.data(b,"tmplItem"))&&(b=b.parentNode));return c||p},template:function(c,b){if(b){if(typeof b==="string")b=o(b);else if(b instanceof a)b=b[0]||{};if(b.nodeType)b=a.data(b,"tmpl")||a.data(b,"tmpl",o(b.innerHTML));return typeof c==="string"?(a.template[c]=b):b}return c?typeof c!=="string"?a.template(null,c):a.template[c]||a.template(null,q.test(c)?c:a(c)):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(){b={}},afterManip:function(f,b,d){var e=b.nodeType===11?a.makeArray(b.childNodes):b.nodeType===1?[b]:[];d.call(f,b);m(e);c++}});function i(e,g,f){var b,c=f?a.map(f,function(a){return typeof a==="string"?e.key?a.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+d+'="'+e.key+'" $2'):a:i(a,e,a._ctnt)}):e;if(g)return c;c=c.join("");c.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(f,c,e,d){b=a(e).get();m(b);if(c)b=j(c).concat(b);if(d)b=b.concat(j(d))});return b?b:j(c)}function j(c){var b=document.createElement("div");b.innerHTML=c;return a.makeArray(b.childNodes)}function o(b){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+a.trim(b).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(m,l,j,d,b,c,e){var i=a.tmpl.tag[j],h,f,g;if(!i)throw"Template command not found: "+j;h=i._default||[];if(c&&!/\w$/.test(b)){b+=c;c=""}if(b){b=k(b);e=e?","+k(e)+")":c?")":"";f=c?b.indexOf(".")>-1?b+c:"("+b+").call($item"+e:b;g=c?f:"(typeof("+b+")==='function'?("+b+").call($item):("+b+"))"}else g=f=h.$1||"null";d=k(d);return"');"+i[l?"close":"open"].split("$notnull_1").join(b?"typeof("+b+")!=='undefined' && ("+b+")!=null":"true").split("$1a").join(g).split("$1").join(f).split("$2").join(d?d.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,function(d,c,b,a){a=a?","+a+")":b?")":"";return a?"("+c+").call($item"+a:d}):h.$2||"")+"_.push('"})+"');}return _;")}function n(c,b){c._wrap=i(c,true,a.isArray(b)?b:[q.test(b)?b:a(b).html()]).join("")}function k(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function s(b){var a=document.createElement("div");a.appendChild(b.cloneNode(true));return a.innerHTML}function m(o){var n="_"+c,k,j,l={},e,p,i;for(e=0,p=o.length;e<p;e++){if((k=o[e]).nodeType!==1)continue;j=k.getElementsByTagName("*");for(i=j.length-1;i>=0;i--)m(j[i]);m(k)}function m(j){var p,i=j,k,e,m;if(m=j.getAttribute(d)){while(i.parentNode&&(i=i.parentNode).nodeType===1&&!(p=i.getAttribute(d)));if(p!==m){i=i.parentNode?i.nodeType===11?0:i.getAttribute(d)||0:0;if(!(e=b[m])){e=f[m];e=g(e,b[i]||f[i],null,true);e.key=++h;b[h]=e}c&&o(m)}j.removeAttribute(d)}else if(c&&(e=a.data(j,"tmplItem"))){o(e.key);b[e.key]=e;i=a.data(j.parentNode,"tmplItem");i=i?i.key:0}if(e){k=e;while(k&&k.key!=i){k.nodes.push(j);k=k.parent}delete e._ctnt;delete e._wrap;a.data(j,"tmplItem",e)}function o(a){a=a+n;e=l[a]=l[a]||g(e,b[e.parent.key+n]||e.parent,null,true)}}}function u(a,d,c,b){if(!a)return l.pop();l.push({_:a,tmpl:d,item:this,data:c,options:b})}function w(d,c,b){return a.tmpl(a.template(d),c,b,this)}function x(b,d){var c=b.options||{};c.wrapped=d;return a.tmpl(a.template(b.tmpl),b.data,c,b.item)}function v(d,c){var b=this._wrap;return a.map(a(a.isArray(b)?b.join(""):b).filter(d||"*"),function(a){return c?a.innerText||a.textContent:a.outerHTML||s(a)})}function t(){var b=this.nodes;a.tmpl(null,null,null,this).insertBefore(b[0]);a(b).remove()}})(jQuery);window.log=function(){log.history=log.history||[];log.history.push(arguments);arguments.callee=arguments.callee.caller;if(this.console){console.log(Array.prototype.slice.call(arguments))}};(function(c){c.fn.spinbox=function(f){if(f&&typeof(f)==="String"&&f==="destroy"){return this.unbind(".spinbox").removeClass(f.spinboxClass).removeClass(f.upClass).removeClass(f.downClass).removeClass(f.upHoverClass).removeClass(f.downHoverClass).removeData("spinboxMin").removeData("spinboxMax").removeData("spinboxReset").removeData("spinboxStep").removeData("spinboxBigStep")}var g;f=c.extend({},c.fn.spinbox.defaults,f);this.each(function(){var m=c(this),j=d("spinboxMin",this),h=d("spinboxMax",this),l=d("spinboxStep",this),i=d("spinboxBigStep",this),k=d("spinboxReset",this),n=d("spinboxScale",this);if(j===g){j=b(m.attr("min"),f.min)}if(h===g){h=b(m.attr("max"),f.max)}if(!l){l=b(m.attr("step"),f.step)}if(!i){i=b(m.attr("bigStep"),f.bigStep)}if(k===g){k=b(f.reset,m.val(),j,h)}if(n===g){n=m.data("spinboxScale")}n=(n||e(n))?n:f.scale;if(n===true){n=(l.toString().split(".")[1]||"").length}m.data("spinboxMin",j);m.data("spinboxMax",h);m.data("spinboxStep",l);m.data("spinboxBigStep",i);m.data("spinboxReset",k);m.data("spinboxScale",n)});return this.each(function(){var k,o,h,m;var n=c(this);n.bind("mousemove.spinbox",function(s){var r=c(this);var t=r.offset();var p=r.height()/2;var q=(s.pageX>t.left+r.width()-f.buttonWidth);k=q&&(s.pageY<=t.top+p);o=q&&(s.pageY>t.top+p);r.toggleClass(f.upHoverClass,k).toggleClass(f.downHoverClass,o)}).bind("mouseout.spinbox",function(){i();c(this).removeClass([f.upClass,f.downClass,f.upHoverClass,f.downHoverClass].join(" "));k=o=null}).bind("mousedown.spinbox",function(p){if(k||o){c(this).toggleClass(f.upClass,k).toggleClass(f.downClass,o);l.apply(this,[p]);j(this,p)}}).bind("mouseup.spinbox",function(p){i();c(this).removeClass(f.upClass).removeClass(f.downClass)}).bind("keydown.spinbox",function(t){if(!f.keys||c.grep(f.keys,function(u){return u===t.keyCode||(u instanceof RegExp&&u.test(String.fromCharCode(t.keyCode)))}).length){var s=c(this);var q={up:38,down:40,pageUp:33,pageDown:34};var p=s.data("spinboxBigStep");var r=t.shiftKey?p:s.data("spinboxStep");switch(t.keyCode){case q.up:l.apply(this,[t,r,1]);break;case q.down:l.apply(this,[t,r,-1]);break;case q.pageUp:l.apply(this,[t,p,1]);break;case q.pageDown:l.apply(this,[t,p,-1]);break}}else{return !f.keys}}).bind("change.spinbox",function(p){if(c(this).val()!=""){l.apply(this,[p,0])}}).bind("focus",function(p){if(c(this).val()==""){c(this).val(f.min).focus()}}).addClass(f.spinboxClass);if(f.mousewheel){c(this).bind("mousewheel.spinbox DOMMouseScroll.spinbox",function(q){var p=q.shiftKey?c(this).data("spinboxBigStep"):c(this).data("spinboxStep");if(q.detail<0||q.wheelDelta>=120){l.apply(this,[q,p,1])}else{if(q.detail>0||q.wheelDelta<=-120){l.apply(this,[q,p,-1])}}return false})}l.apply(this,[c.Event(),0]);function l(u,r,w){var p=c(this);if(f.ignore&&p.is(f.ignore)){return}r=b(r,p.data("spinboxStep"),1);w=w||(o?-1:1);var x=p.val();var q=b(x,p.data("spinboxReset"),0);var s=b(p.data("spinboxMin"));var v=b(p.data("spinboxMax"));var t=[q,r,s,v,w,x,f];if(w>0){q=f.increment.apply(this,t)}else{if(w<0){q=f.decrement.apply(this,t)}}if(e(p.data("spinboxScale"))&&f.round){q=f.round(q,p.data("spinboxScale"))}if(e(s)){q=Math.max(q,s)}if(e(v)){q=Math.min(q,v)}var t=[q,r,s,v,w,x,f];if(q!=x&&p.triggerHandler("beforeSpin",t)!==false){p.val(q);if(f.change){p.trigger("change",t)}p.triggerHandler("spin",t);p.removeClass("placeheld")}}function j(p,q){i();h=window.setTimeout(function(){l.apply(p,[q]);m=window.setInterval(function(){l.apply(p,[q])},f.repeat)},f.delay)}function i(){window.clearTimeout(h);window.clearInterval(m)}})};function e(f){return !isNaN(parseFloat(f))}function b(f){for(var g=0;g<arguments.length;g++){if(e(arguments[g])){return Number(parseFloat(arguments[g]))}}return}function d(g,j){var i=c(j||this).attr("class"),h=new RegExp("(\\b"+g+")(\\S*)").exec(i),f={"true":true,True:true,"false":false,False:false};
if(h&&h.length>=3&&f[h[3]]!==undefined){h[3]=f[h[3]]}return !h?undefined:h.length>=3?h[2]:null}c.fn.spinbox.defaults={min:0,max:null,step:1,bigStep:10,keys:[/[0-9]/,9,13,8,46,33,34,37,38,39,40,109,188,190],ignore:"[readonly],[disabled]",spinboxClass:"spinbox-active",upClass:"spinbox-up",downClass:"spinbox-down",upHoverClass:"spinbox-up-hover",downHoverClass:"spinbox-down-hover",mousewheel:true,change:true,increment:function(j,i,h,f,g){return j+i},decrement:function(j,i,h,f,g){return j-i},reset:null,delay:500,repeat:100,buttonWidth:20,scale:true,round:function a(f,g){return Math.round(f*Math.pow(10,g))/Math.pow(10,g)}}})(jQuery);(function(a){a.fn.render=function(b){var j=function(){var o=["Moz","Webkit","Khtml","O","Ms"],n=["-moz-","-webkit-","-khtml-","-o-","-ms-"],m={};return function(t){el=document.documentElement;var s=el.style,p,q,r;if(arguments.length===1&&typeof m[t]==="string"){return m[t]}if(typeof s[t]==="string"){return m[t]=t}p=t.charAt(0).toUpperCase()+t.slice(1);r=o.length;for(q=0;q<r;q++){if(typeof s[o[q]+p]==="string"){return m[t]=n[q]+t}}}}();var l=this,k,i,f,h,g={},e={},c={translate:Modernizr.csstransforms3d?function(m){return"translate3d("+m[0]+"px, "+m[1]+"px, 0)"}:function(m){return"translate("+m[0]+"px, "+m[1]+"px)"},rules:function(o,n){var m={};m[j(o)]=c.translate(n);return m},initRow:function(m){e.rows[e.currentRow]={width:0,height:m,elements:[]}}},d={init:function(m){e=a.extend({},g,m);return this.each(function(){k=a(this);i=k.children();d.create();d.resetLayout();d.layout()})},create:function(){a("#holder").remove();f=a("<div>",{id:"holder","class":k.parent().attr("class")}).removeClass("listContent");var m=i.eq(0).clone().css({"background-image":null}).empty();m.append(a("<div>",{"class":"block"}));f.append(m);f.appendTo("body");e.styles=[];k.addClass("rendered").css({position:"relative",});i.css({position:"absolute",top:0,left:"50%"})},relayout:function(){return this.each(function(){k=a(this);i=k.children().css({position:"absolute",top:0,left:"50%"});f=a("#holder");d.resetLayout();d.layout()})},layout:function(){e.styles.push({$el:k,styles:{visibility:"visible"}});h=k.parent().hasClass("hasCovers");e.width=k.width();e.holderOuterWidth=f.children().outerWidth(true);e.holderOuterHeight=f.children().outerHeight(true);i.each(function(){var m=a(this);if(!h){e.holderOuterWidth=m.outerWidth(true)}if(e.rows[e.currentRow].width+e.holderOuterWidth>e.width){e.currentRow++;c.initRow(e.rows[e.currentRow-1].height+e.holderOuterHeight)}e.rows[e.currentRow].width+=e.holderOuterWidth;e.rows[e.currentRow].elements.push(m)});a.each(e.rows,function(m,n){e.pos.x=(e.width/2)*-1+(e.width-n.width)/2;e.pos.y=n.height;a.each(n.elements,function(p,o){e.styles.push({$el:o,styles:c.rules("transform",[e.pos.x,e.pos.y])});if(!h){e.pos.x+=o.outerWidth(true)}else{e.pos.x+=e.holderOuterWidth}})});a.each(e.styles,function(m,n){n.$el.css(n.styles)});e.rows=[];e.styles=[]},resetLayout:function(){e.pos={x:0,y:0,height:0};e.styles=[];e.rows=[];e.currentRow=0;c.initRow(0)}};if(d[b]){return d[b].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof b==="object"||!b){return d.init.apply(this,arguments)}else{a.error('Method "'+b+'" does not exist in render plugin!')}}}})(jQuery);var debugCacheManifest=1;if(debugCacheManifest){var cacheStatusValues=[];cacheStatusValues[0]="uncached";cacheStatusValues[1]="idle";cacheStatusValues[2]="checking";cacheStatusValues[3]="downloading";cacheStatusValues[4]="updateready";cacheStatusValues[5]="obsolete";function logEvent(f){var b,a,c,d;b=(navigator.onLine)?"yes":"no";a=cacheStatusValues[cache.status];c=f.type;d="online: "+b;d+=", event: "+c;d+=", status: "+a;if(c=="error"&&navigator.onLine){d+=" (prolly a syntax error in manifest)"}console.log(d)}var cache=window.applicationCache;cache.addEventListener("cached",logEvent,false);cache.addEventListener("checking",logEvent,false);cache.addEventListener("downloading",logEvent,false);cache.addEventListener("error",logEvent,false);cache.addEventListener("noupdate",logEvent,false);cache.addEventListener("obsolete",logEvent,false);cache.addEventListener("progress",logEvent,false);cache.addEventListener("updateready",logEvent,false);window.applicationCache.addEventListener("updateready",function(){window.applicationCache.swapCache();window.location.reload();console.log("swap cache has been called")},false);setInterval(function(){cache.update()},10000)}var subDomains=["s1","s2"],useSubDomains=false;$(document).ready(function(){if(window.location.host=="lms.dev"||window.location.host=="lms"){useSubDomains=true;for(var a=0;a<subDomains.length;a++){subDomains[a]=window.location.protocol+"//"+subDomains[a]+"."+window.location.host+"/"}}if($.browser.mozilla){$("html").addClass("mozilla")}$("#ajax_loader").ajaxStart(function(){$("#ajax_loader").addClass("loading")}).ajaxStop(function(){$("#ajax_loader").removeClass("loading")}).ajaxError(function(f,g,e,d){if(g.responseText!=""){inform("Error requesting page "+e.url+", error : "+g.responseText,"error")}});window.addEventListener("hashchange",tabSwitch,false);tabSwitch();$("#editHide, #detailHide, #storageHide, #previewHide, #confirmHide").click();$(".spinbox:not(.spinbox-active)").spinbox({min:1,max:null,step:1,reset:0,});$(".add_another").click(function(g){g.preventDefault();if(!$(this).is("button")){return}var e=$(this).siblings("ol"),d=$(".anotherInfo:last",e).clone(true),f=$("input",d).attr("id").split("_"),h=parseInt(f[1]);d.children("input").attr("id",function(j,i){return i.replace(new RegExp(h),h+1)}).attr("name",function(j,i){return i.replace(new RegExp(h),h+1)}).val("").siblings("label").attr("for",$("input",d).attr("id"));e.append(d)});$(".delete_another").click(function(d){d.preventDefault();if(!$(this).is("button")){return}if($(this).closest("ol").children("li").length>1){$(this).closest(".anotherInfo").remove()}else{$(this).siblings("input").val("")}});$(".filterForm").each(function(){var f=$(this),d=f.children(".sortTypeField");if(d.length){var e=d.val();if(e==""){e=d.val(0).val()}if(e%2==0){f.find(".listSort a[href="+e+"]").removeClass("both desc").addClass("asc")}else{f.find(".listSort a[href="+e+"]").removeClass("both asc").addClass("desc")}}}).delegate(".filterFormSwitch","click",function(f){f.preventDefault();if(!$(this).is("a")){return}var d=$(this).closest(".listFilter").toggleClass("deploy");if(d.hasClass("deploy")){d.find("datalist, select").loadList()}}).delegate(".search","click",function(d){d.preventDefault();getList(1)}).delegate(".cancel","click",function(d){d.preventDefault();$(this).closest(".filterForm").find(":input").val("");getList(0)}).delegate(".sort","click",function(i){i.preventDefault();var g=$(this);if(!g.is("a")){return}var j=g.attr("class"),d=g.closest(".filterForm"),f=g.attr("href");$(".sort",d).removeClass("asc").removeClass("desc").addClass("both");g.attr("class",j);if(g.hasClass("both")){g.toggleClass("both asc")}else{if(g.hasClass("asc")){g.toggleClass("asc desc");f++}else{if(g.hasClass("desc")){g.toggleClass("desc both");$(".sort:first",d).click();return}}}d.children(".sortTypeField").val(f);getList(1)});$(".add").click(function(i){i.preventDefault();if(!$(this).is("button")){return}var d=$(this).attr("rel"),g=$("#manage_"+d),f="",h="",j="Enregistrer ";
if(d=="book"){another="bookAuthors";f="bookAuthor";h="author"}else{if(d=="album"){another="albumBands";f="albumBand";h="band"}else{if(d=="movie"){another="movieArtists";f="movieArtist";h="artist"}}}if(f!=""){$("#"+another).children(".anotherInfo:gt(0)").remove();$("#"+another).find("input").attr("id",f+"_1").attr("name",h+"_1").siblings("label").attr("for",f+"_1")}g.find(":input").val("").change();g.find(".coverStatus").html(function(){var e="D√©poser ";d=="book"||d=="album"?e+="la couverture":e+="l'affiche"});$("#editPreview").empty();$("#"+d+"Action").val("add");hideInform();d=="book"||d=="movie"||d=="band"||d=="storage"?j+=" le nouveau ":d=="album"||d=="author"||d=="artist"?j+=" le nouvel ":j+=" la nouvelle ";if(d=="book"){j+="livre"}else{if(d=="movie"){j+="film"}else{if(d=="album"){j+="album"}else{if(d=="saga"){j+="saga"}else{if(d=="author"){j+="auteur"}else{if(d=="artist"){j+="artiste"}else{if(d=="band"){j+="groupe"}else{if(d=="storage"){j="rangement"}}}}}}}}g.appendTo($("#editForm .formWrapper").empty());$("#editForm .formTitle").html(j);$("#formSubmit").data("save_clicked",0).attr("rel","add").text("Enregistrer");$("#editShow").attr("rel",d).click()});$(".update").live("click",function(g){g.preventDefault();if(!$(this).is("a")){return}var i=$(this),m=i.attr("rel"),h=m.charAt(0).toUpperCase()+m.substr(1),j=$("#manage_"+m),k="",l="Modifier les informations ",f=$("#editPreview").empty();if(m=="book"){k="bookAuthors"}else{if(m=="movie"){k="movieArtists"}else{if(m=="album"){k="albumBands"}}}if(k!=""){$("#"+k).children(".anotherInfo:gt(0)").remove()}j.find(":input").val("");j.find(".coverStatus").html(function(){return"D√©poser "+(m=="movie"?"l'affiche":"la couverture")});$("#"+m+"Action").val("update");hideInform();if(m=="book"){l+="du livre"}else{if(m=="movie"){l+="du film"}else{if(m=="album"){l+="du l'album"}else{if(m=="saga"){l+="de la saga"}else{if(m=="author"){l+="de l'auteur"}else{if(m=="artist"){l+="de l'artiste"}else{if(m=="band"){l+="du groupe"}else{if(m=="storage"){l="du rangement"}}}}}}}}j.appendTo($("#editForm .formWrapper").empty());$("#editForm .formTitle").html(l);$("#formSubmit").data("save_clicked",0).attr("rel","update").text("Enregistrer");$("#editShow").attr("rel",m).click();var d=$("<textarea>");$.post("ajax/manage"+h+".php","action=get&id="+i.attr("href"),function(e){switch(m){case"book":$("#bookID").val(e.bookID);$("#bookTitle").val(d.html(e.bookTitle).val()).change();$("#bookSize").val(e.bookSize);$("#bookCover").val(e.bookCover);$("<img>",{src:"image.php?cover=book&id="+e.bookID}).appendTo(f);$("#bookSagaTitle").val(d.html(e.sagaTitle).val()).change();$("#bookSagaPosition").val(e.bookSagaPosition);$("#bookStorage").data("selectedId",e.storageID);var n=1;$.each(e.authors,function(o,p){if(n>1){$("#another_author").click()}$("#bookAuthor_"+n).val(d.html(p.authorFirstName+" "+p.authorLastName).val());n++});break;case"movie":$("#movieID").val(e.movieID);$("#movieTitle").val(d.html(e.movieTitle).val()).change();$("#movieGenre").val(d.html(e.movieGenre).val());$("#movieMediaType").val(d.html(e.movieMediaType).val());$("#movieLength").val(e.movieLength);$("#movieCover").val(e.movieCover);$("<img>",{src:"image.php?cover=movie&id="+e.movieID}).appendTo(f);$("#movieSagaTitle").val(d.html(e.sagaTitle).val()).change();$("#movieSagaPosition").val(e.movieSagaPosition);$("#movieStorage").data("selectedId",e.storageID);var n=1;$.each(e.artists,function(p,o){if(n>1){$("#another_artist").click()}$("#movieArtist_"+n).val(d.html(o.artistFirstName+" "+o.artistLastName).val());n++});break;case"album":$("#albumID").val(e.albumID);$("#albumTitle").val(d.html(e.albumTitle).val()).change();$("#albumType").val(e.albumType);$("#albumCover").val(e.albumCover);$("<img>",{src:"image.php?cover=album&id="+e.albumID}).appendTo(f);$("#albumStorage").data("selectedId",e.storageID);var n=1;$.each(e.bands,function(o,p){if(n>1){$("#another_band").click()}$("#albumBand_"+n).val(d.html(p.bandName).val());n++});break;case"author":$("#authorID").val(e.authorID);
$("#authorFirstName").val(d.html(e.authorFirstName).val());$("#authorLastName").val(d.html(e.authorLastName).val());$("#authorWebSite").val(e.authorWebSite);$("#authorSearchURL").val(e.authorSearchURL);break;case"band":$("#bandID").val(e.bandID);$("#bandName").val(d.html(e.bandName).val()).change();$("#bandGenre").val(d.html(e.bandGenre).val());$("#bandWebSite").val(e.bandWebSite);break;case"artist":$("#artistID").val(e.artistID);$("#artistFirstName").val(d.html(e.artistFirstName).val());$("#artistLastName").val(d.html(e.artistLastName).val());break;case"saga":$("#sagaID").val(e.sagaID);$("#sagaTitle").val(d.html(e.sagaTitle).val());$("#sagaSearchURL").val(e.sagaSearchURL);break;case"storage":$("#storageID").val(e.storageID);$("#storageRoom").val(e.storageRoom);$("#storageType").val(e.storageType);$("#storageColumn").val(e.storageColumn);$("#storageLine").val(e.storageLine);$("<img>",{src:"image.php?cover=storage&id="+e.storageID}).appendTo(f);break}})});$(".delete").live("click",function(j){j.preventDefault();if(!$(this).is("a")){return}hideInform();var i=$(this),l=i.attr("href"),d=i.attr("rel"),h=d.charAt(0).toUpperCase()+d.substr(1),k="Etes-vous s√ªr de vouloir supprimer ",g=$("#confirmForm .formWrapper"),f=$("#confirmSubmit").data("save_clicked",0);if(d=="book"){k+="ce livre ?"}else{if(d=="album"){k+="cet album ?"}else{if(d=="movie"){k+="ce film ?"}else{if(d=="saga"){k+="cette saga ?<br />Tous les livres et films list√©s ci-dessous seront √©galement supprim√©s !"}else{if(d=="author"){k+="cet auteur ?<br />Tous les livres list√©s ci-dessous seront √©galement supprim√©s !"}else{if(d=="artist"){k+="cet artiste ?<br />Tous les films list√©s ci-dessous seront √©galement supprim√©s !"}else{if(d=="band"){k+="ce groupe ?<br />Tous les albums list√©s ci-dessous seront √©galement supprim√©s !"}else{if(d=="storage"){k+="ce rangement ?"}else{if(d=="loan"){k+="ce pr√™t ?"}}}}}}}}}g.html($("<span>",{"class":"confirmation"}).append(k));f.data("save_clicked",0);$("#confirmShow").attr("rel",d).data("id",l).click();if(d=="saga"||d=="author"||d=="artist"||d=="band"){$.ajax({url:"ajax/manage"+h+".php",type:"POST",data:"action=impact&id="+l,async:false,dataType:"html",success:function(e){g.append(e)}})}if(d=="storage"){$.ajax({url:"ajax/manage"+h+".php",type:"POST",data:"action=impact&id="+l,async:false,dataType:"html",success:function(e){g.append(e);f.prop({disabled:true})}})}});$("#relocate").live("click",function(f){f.preventDefault();if(!$(this).is("button")){return}hideInform();if($("#storageList").val()==""){formErrors([["storageList","Le nouveau rangement est requis.","required"]])}else{var d=$("#impactStorage");$.post("ajax/manageStorage.php","action=relocate&"+$.param(d.find("input:checked, select"),true),function(e){if(e=="ok"){inform("Nouvelle allocation effectu√©e","success");d.find(":input:checked").parent().remove();if(!d.find("input").length){d.remove();$("#confirmSubmit").removeProp("disabled")}}})}});$(".move").live("click",function(i){i.preventDefault();if(!$(this).is("a")){return}hideInform();var h=$(this),k=h.attr("href"),d=h.attr("rel"),g=d.charAt(0).toUpperCase()+d.substr(1),j="Etes-vous s√ªr de vouloir changer le rangement de cette saga ?",f=$("#editForm .formWrapper").empty();$("#editForm .formTitle").html("Modification du rangement");$("#formSubmit").data("save_clicked",0);$("#editPreview").empty();$.ajax({url:"ajax/manage"+g+".php",type:"POST",data:"action=moveImpact&id="+k,async:false,dataType:"html",success:function(e){f.append(e)}});$("#editShow").attr("rel","move").data("id",k).click()});$(".addLoan").live("click",function(h){h.preventDefault();if(!$(this).is("a")){return}var g=$(this),f=$("#manage_loan"),i="Enregistrer le nouveau pr√™t",d=$("#editForm");f.find(":input").val("");$("#editPreview").empty();$("#loanAction").val("add");$("#loanFor").val(g.attr("rel"));$("#itemID").val(g.attr("href"));hideInform();f.appendTo(d.find(".formWrapper").empty());d.find(".formTitle").html(i);$("#formSubmit").data("save_clicked",0).attr("rel","add").text("Enregistrer");
$("#editShow").attr("rel","loan").click()});$(".list").delegate(".storage","click",function(h){h.preventDefault();var g=$(this);if(!g.is("a")){return}if(g.closest("#list_storage").length){var d=$("#detailBox"),f=$("#detail");d.data("link",g.attr("href")).data("tab",$("#nav").data("activeTab"));f.html(g.parent().find(".block").clone(true));$("#detailShow").click();$("#storageImg").removeAttr("src").attr("src",g.attr("href"));$("#storageShow").click()}else{if($("#storageShow:checked").length){$("#storageHide").click()}else{$("#storageImg").attr("src",g.attr("href"));$("#storageShow").click()}}}).delegate(".detail","click",function(h){h.preventDefault();var g=$(this);if(!g.is("a")){return}var d=$("#detailBox"),f=$("#detail"),i=f.find(".close").clone();d.data("link",g.attr("href")).data("tab",$("#nav").data("activeTab"));$("#storageHide").attr("checked","checked");f.html(g.parent().find(".block").clone(true).append(i));$("#detailShow").click()});$(".filter").live("click",function(h){h.preventDefault();var g=$(this);if(!g.is("a")){return}var d=g.attr("rel");if(!d){return}d=d.charAt(0).toUpperCase()+d.substr(1);var f=$("#nav").data("activeTab");$("#"+f+d+"Filter").val(g.attr("href"));$("#"+f+"_filter .listFilter").addClass("deploy");getList(1);$("#detailHide, #editHide, #previewHide, #storageHide, #confirmHide").prop({checked:true})});$(".form").each(function(){this.addEventListener("invalid",checkField,true);this.addEventListener("blur",checkField,true);this.addEventListener("input",checkField,true)}).submit(function(d){d.preventDefault();$("#formSubmit").click()});$("#formSubmit").click(function(i){i.preventDefault();var h=$(this),f=h.closest(".wrapper").find(".form");if(!f.length){return}var d=$("#editBox .form").attr("rel"),g=d.charAt(0).toUpperCase()+d.substr(1);if(h.data("save_clicked")!=1){h.data("save_clicked",1);hideInform();if(d!="move"){$.ajax({url:"ajax/manage"+g+".php",data:f.find(":input").serialize(),type:"POST",dataType:"json",complete:function(){h.data("save_clicked",0)},success:function(e){if(e=="ok"){var j=$("#confirmForm");$("#editHide").click();if($("#confirmShow:checked").length){if(d=="saga"||d=="author"||d=="artist"||d=="band"){$.ajax({url:"ajax/manage"+g+".php",type:"POST",data:"action=impact&id="+id,async:false,dataType:"html",success:function(k){j.find(".impact").remove();j.find(".formWrapper").append(k)}})}else{if(d=="storage"){$.ajax({url:"ajax/manage"+g+".php",type:"POST",data:"action=impact&id="+id,async:false,dataType:"html",success:function(k){$("#impactStorage").remove();j.find(".formWrapper").append(k);$("#confirmSubmit").prop({disabled:true})}})}}}else{getList(2)}inform(($("#"+d+"Action").val()=="add"?"Ajout effectu√©":"Mise √† jour effectu√©e"),"success")}else{inform("Erreur durant la validation du formulaire","error");formErrors(e)}}})}else{$.post("ajax/manageSaga.php","action=move&id="+$("#editShow").data("id")+"&"+$("#moveSaga").serialize(),function(e){if(e=="ok"){getList(2);inform("Modification effectu√©e","success");$("#editHide").click()}else{inform("Erreur durant la modification","error");formErrors(e)}})}}});$("#formCancel").click(function(d){d.preventDefault();$("#editHide").click()});$("#confirmSubmit").click(function(i){i.preventDefault();var h=$(this),f=h.closest(".wrapper"),d=$("#confirmShow").attr("rel"),g=d.charAt(0).toUpperCase()+d.substr(1);if(h.data("save_clicked")!=1){h.data("save_clicked",1);hideInform();$.post("ajax/manage"+g+".php","action=delete&id="+$("#confirmShow").data("id"),function(e){if(e=="ok"){getList(2);inform("Suppression effectu√©e","success");$("#confirmHide").click()}else{inform("Erreur durant la suppression","error");formErrors(e)}})}});$("#confirmCancel").click(function(d){d.preventDefault();$("#confirmHide").click()});$("#editHide").click(function(g){var f=$("#editBox");if(f.find(".form").length){var d=f.find(".form").attr("rel");if(f.find(".coverStatus").length){$("html, #drop_overlay").unbind("dragenter").unbind("dragover").unbind("dragleave").unbind("dragend");
$("html").get(0).removeEventListener("drop",dropCover,true)}$("#manage_"+d).appendTo($("body"))}});$("#editShow").click(function(h){var d=$(this).attr("rel"),g=d.charAt(0).toUpperCase()+d.substr(1),f=$("#editBox .formWrapper");if($("img","#editPreview").length){$("#previewShow").click()}else{$("#previewHide").click()}f.find(":input, .coverStatus").removeClass("required valid error upload");if(f.find(".coverStatus").length){$("html, #drop_overlay").bind("dragenter",dragEnter).bind("dragover",dragOver).bind("dragleave",dragLeave);$("html").get(0).addEventListener("drop",dropCover,true)}if($("#editPreview").find("img").length){$("#previewShow").prop({checked:true})}$("datalist, select",f).loadList()});$(".close").live("click",function(d){d.preventDefault();if(!$(this).is("button")){return}var f=$(this).closest(".box").attr("id");if(f=="editBox"){$("#editHide, #previewHide").click()}else{if(f=="detailBox"){$("#detailHide, #storageHide").click()}else{if(f=="confirmBox"){$("#confirmHide").click()}else{$("#detailHide, #editHide, #previewHide, #storageHide, #confirmHide").click()}}}});$("#editShow, #detailShow, #storageShow, #previewShow, #confirmShow").click(function(d){$(document).unbind("keydown")});$("#editHide, #detailHide, #storageHide, #previewHide, #confirmHide").click(function(d){addShortcutsSupport()});$("#nav a").click(function(f){var d=$(this).attr("href").substr(1);if(d==$("#nav").data("activeTab")){f.preventDefault();getList(0)}});$("#helpSwitch").click(function(d){d.preventDefault();$("#help").toggleClass("deploy")});addShortcutsSupport();addEscapeSupport();$("a.button").live("click",function(d){$(this).blur()});$(".listDisplaySwitch a").click(function(h){h.preventDefault();var g=$(this),i=g.closest(".listDisplaySwitch").find("a").map(function(){return this.rel}).get().join(" "),d=g.closest(".list"),f=g.attr("rel");g.addClass("disabled").siblings().removeClass("disabled");$("#holder").removeClass(i).addClass(f);d.removeClass(i).addClass(f).children(".listContent").render("relayout")});$(".externalLink","#list_band").live("click",function(f){$.post("ajax/manageBand.php",{action:"updateLastCheckDate",id:$(this).attr("rel")});if($("#bandSortType").val()>=2){var g=$(this).closest("li");var d=g.parent();if($("#bandSortType").val()==2){g.appendTo(d)}else{g.prependTo(d)}}});var b=$("<a>",{"class":"button icon externalLink small quickLink",target:"_blank","data-icon":"/"});$("#movieTitle").change(function(){$(this).siblings("label").html(function(){return $(this).text()}).append($(this).val()!=""?b.clone().attr("title","Rechercher sur Google Image").attr("href","http://www.google.com/images?q="+$(this).val()+" movie"):"").append($(this).val()!=""?b.clone().attr("title","Rechercher sur IMDB").attr("href","http://www.imdb.com/find?s=all&q="+$(this).val()):"")});$("#bookTitle").change(function(){$(this).siblings("label").html(function(){return $(this).text()}).append($(this).val()!=""?b.clone().attr("title","Rechercher sur Google Image").attr("href","http://www.google.com/images?q="+$(this).val()+" book"):"").append($(this).val()!=""?b.clone().attr("title","Rechercher sur Fantastic Fiction").attr("href","http://www.fantasticfiction.co.uk/search/?searchfor=book&keywords="+$(this).val()):"")});$("#albumTitle").change(function(){$(this).siblings("label").html(function(){return $(this).text()}).append($(this).val()!=""?b.clone().attr("title","Rechercher sur Google Image").attr("href","http://www.google.com/images?q="+$(this).val()+" music album"):"")});$("#bandName").change(function(){$(this).siblings("label").html(function(){return $(this).text()}).append($(this).val()!=""?b.clone().attr("title","Rechercher sur Wikipedia").attr("href","http://en.wikipedia.org/w/index.php?search="+$(this).val()):"")});$("#bookSagaTitle, #movieSagaTitle").change(function(){var h=$(this);var f=h.closest(".form");var d=f.attr("rel");var g=d.charAt(0).toUpperCase()+d.substr(1);var e=h.siblings("datalist");var i=$("<textarea>");h.siblings("label").html(function(){return $(this).text()
});if(h.val()!=""&&$('option[value="'+h.val()+'"]',e).length){$.post("ajax/manageSaga.php","action=getByTitleFor"+g+"&title="+h.val(),function(j){if(!$.isEmptyObject(j)){if(j.sagaSearchURL!=""&&j.sagaSearchURL!=null){h.siblings("label").append(b.clone().attr("title","D√©tail de cette saga sur internet").attr("href",i.html(j.sagaSearchURL).val()))}if($("#"+d+"Action").val()=="add"){$("#"+d+"SagaPosition").val(j.position).trigger("blur");$("#"+d+"Storage").val(j.storageID).trigger("blur");if(d=="book"){var k=1;$(".anotherInfo:gt(0)","#bookAuthors").remove();$.each(j.authors,function(m,l){if(k>1){$("#another_author").click()}$("#bookAuthor_"+k).val(i.html(l).val()).trigger("blur");k++})}else{if(d=="movie"){var k=1;$(".anotherInfo:gt(0)","#movieArtists").remove();$.each(j.artists,function(m,l){if(k>1){$("#another_artist").click()}$("#movieArtist_"+k).val(i.html(l).val()).trigger("blur");k++})}}}$("#"+d+"SagaPosition").focus().select()}})}});var c=null;$(window).resize(function(){if(c){clearTimeout(c)}c=window.setTimeout(function(){$("#list_"+$("#nav").data("activeTab")).children(".listContent").render("relayout")},100)})});function tabSwitch(){var a=window.location.hash.substr(1)||$(".tab:first").attr("id");$("#nav a").removeClass("active");$("a[href$="+a+"]","#nav").addClass("active");if($("#"+a).length){window.location.hash="#"+a;$("#nav").data("activeTab",a);$("#nav").data("updating",0);getList(0)}}$.fn.loadList=function(){return this.each(function(){var f=$(this),a=f.attr("id"),g=$("<textarea>"),c,b=0;try{c=localStorage.getObject(a);if(c){b=c.lastModified}}catch(d){alert(d)}$.ajax("ajax/loadList.php",{data:"field="+f.attr("id"),dataType:"json",headers:{"If-Modified-Since":b},success:function(j,l,i){if(i.status==200){try{b=i.getResponseHeader("Last-Modified");localStorage.setObject(a,{lastModified:b,data:j})}catch(k){alert(k)}}else{j=c.data;if(f.find("option:gt(0)").length){return}}if(f.is("datalist")){f.empty()}else{var h=false;if(f.attr("id").search(/Filter/)!=-1&&f.val()!=""){f.data("sav",f.val());h=true}f.find("option:gt(0)").remove()}$.each(j,function(e,m){m.value=g.html(m.value).val();$("<option>",{value:(m.id?m.id:m.value),text:m.value}).appendTo(f)});if(h){f.val(list.data("sav"))}if(f.data("selectedId")){f.val(f.data("selectedId"));f.removeData("selectedId")}}})})};String.prototype.urlify=function(){var f=this,b="√Ä√?√Ç√É√Ñ√Ö√†√°√¢√£√§√•√í√ì√î√ï√ï√ñ√ò√≤√≥√¥√µ√∂√∏√à√â√ä√ã√®√©√™√´√∞√á√ß√?√å√?√é√?√¨√≠√Æ√Ø√ô√ö√õ√ú√π√∫√ª√º√ë√±≈†≈°≈∏√ø√Ω≈Ω≈æ ",e=["A","A","A","A","A","A","a","a","a","a","a","a","O","O","O","O","O","O","O","o","o","o","o","o","o","E","E","E","E","e","e","e","e","e","C","c","D","I","I","I","I","i","i","i","i","U","U","U","U","u","u","u","u","N","n","S","s","Y","y","y","Z","z",""],a=[];f=f.split("");len=f.length;for(var d=0;d<len;d++){var c=b.indexOf(f[d]);if(c!=-1){a[d]=e[c]}else{a[d]=f[d]}}return a.join("")};function getFullUrl(a,b){if(useSubDomains){return subDomains[b%subDomains.length]+a+b}return a+b}Storage.prototype.setObject=function(a,b){this.setItem(a,JSON.stringify(b))};Storage.prototype.getObject=function(a){return this.getItem(a)&&JSON.parse(this.getItem(a))};function isStorageChanged(b){var c=this.data.list[b],a=c.storageColumn!=null&&b>0&&(this.data.list[b-1].storageRoom!=c.storageRoom||this.data.list[b-1].storageType!=c.storageType);if(a){this.data.currentStorageURL="storage/"+c.storageRoom.urlify()+"_"+c.storageType.urlify()+".png"}this.data.list[b].storageURL="storage/"+c.storageRoom.urlify()+"_"+c.storageType.urlify()+(c.storageColumn!=null||c.storageLine!=null?"_"+c.storageColumn+c.storageLine:"")+".png";return a}function addEscapeSupport(){$("html").unbind("keypress").keypress(function(a){if(a.keyCode==27){if($("#inform span:visible").length){hideInform()}else{if($("#help").hasClass("deploy")){$(".help").click()}else{if($("#drop_overlay:visible").length){$("#drop_overlay").hide()}else{if($("#storageShow:checked").length){$("#storageHide").click()}else{if($("#previewShow:checked").length){$("#previewHide").click()}else{if($("#editShow:checked").length){$("#editHide").click()
}else{if($("#confirmShow:checked").length){$("#confirmHide").click()}else{if($("#detailShow:checked").length){$("#detailHide").click()}}}}}}}}}})}function addShortcutsSupport(){$(document).unbind("keydown").keydown(function(f){if(f.which==65){$(".add","#"+$("#nav").data("activeTab")).click()}else{if(f.which==70){$(".filterFormSwitch","#"+$("#nav").data("activeTab")).click()}else{if(f.which==86){var b=$(".listDisplaySwitch a","#"+$("#nav").data("activeTab"));if(!b.length){return}var d=$(".listDisplaySwitch","#"+$("#nav").data("activeTab")).find(".disabled");if(!d.length){return}var a=b.index(d);a++;if(a==b.length){a=0}b.eq(a).click()}else{var a=parseInt(String.fromCharCode(f.which));if(!isNaN(a)){if($(".tab").eq(a-1).length){var c=$(".tab").eq(a-1).attr("id");if($("#nav").data("activeTab")==c){getList(0)}else{window.location.hash="#"+c}}}}}}})}function formErrors(a){$.each(a,function(c,b){$("#"+b[0]).addClass(b[2]).siblings(".tip").remove();$("#"+b[0]).parent().append($("<span>",{"class":"tip",text:b[1]}))})}function inform(b,a){$("#inform span").addClass(a).text(b).parent().show()}function hideInform(){$("#inform span").attr("class","").empty().parent().hide()}var dropTimeout=0;function dragEnter(a){a.preventDefault();$("#drop_overlay").show();if(a.dataTransfer){a.dataTransfer.effectAllowed="copy";a.dataTransfer.dropEffect="copy"}else{if(a.originalEvent.dataTransfer){a.originalEvent.dataTransfer.effectAllowed="copy";a.originalEvent.dataTransfer.dropEffect="copy"}}dropTimeout=window.setTimeout(function(){$("#drop_overlay").hide()},3000)}function dragOver(a){a.preventDefault();if($("#drop_overlay:hidden").length){$("#drop_overlay").show()}clearTimeout(dropTimeout);dropTimeout=window.setTimeout(function(){$("#drop_overlay").hide()},3000)}function dragLeave(a){a.stopPropagation()}function dropCover(f){f.preventDefault();$("#drop_overlay").hide();var g=$("#editBox").find(".form"),a=g.attr("rel"),b=$(".coverStatus",g).removeClass("required valid error upload");if(!b.data("oldText")){b.data("oldText",b.html())}var e=f.dataTransfer;var d=e.files;if(d.length==0&&e.types.contains("application/x-moz-file-promise-url")){hideInform();url=e.getData("application/x-moz-file-promise-url");b.addClass("upload");$.ajax({url:"ajax/manageCover.php?rel="+a,data:"url="+e.getData("application/x-moz-file-promise-url"),complete:function(h){b.removeClass("upload")},success:function(h){var i=new Date().getTime();$("#editPreview").empty().append($("<img>",{src:"covers/"+h+"?"+i}));$("#"+a+"Cover").val(h);b.html(b.data("oldText")).addClass("valid");if(!$("#previewShow:checked").length){$("#previewShow").click()}},error:function(h,j,i){b.html(i).addClass("error")}});return}if(d.length>1){formErrors([[a+"CoverStatus","Une seule image est permise, seule la premi√®re est prise en compte.","warning"]])}var c=d[0];if(c.type.match(/image.(jpe?g|png|gif)/)){upload(c,a,b)}else{formErrors([[a+"CoverStatus","Seule les images .jpg, .jpeg, .png or .gif sont permises.","error"]])}}function upload(d,b,c){if(window.FileReader){hideInform();var a=new FileReader();if(typeof(a.addEventListener)==="function"){a.addEventListener("loadend",function(){var e=new XMLHttpRequest();e.open("POST","ajax/manageCover.php?up=true&rel="+b,true);e.setRequestHeader("UP-NAME","upload");e.setRequestHeader("UP-FILENAME",d.name);e.setRequestHeader("UP-SIZE",d.size);e.setRequestHeader("UP-TYPE",d.type);e.send(window.btoa(a.result));c.addClass("upload");e.onreadystatechange=function(){if(e.readyState==4){c.removeClass("upload");if(e.status==200){c.html(c.data("oldText")).addClass("valid");var f=new Date().getTime();$("#editPreview").empty().append($("<img>",{src:"covers/"+d.name+"?"+f}));$("#"+b+"Cover").val(d.name);if(!$("#previewShow:checked").length){$("#previewShow").click()}}else{c.html(e.responseText).addClass("error")}}}},true);a.addEventListener("error",function(e){switch(e.target.error.code){case e.target.error.NOT_FOUND_ERR:c.html("Fichier non trouv√©!").removeClass("upload").addClass("error");
break;case e.target.error.NOT_READABLE_ERR:c.html("Fichier non lisible!").removeClass("upload").addClass("error");break;case e.target.error.ABORT_ERR:break;default:c.html("Erreur de lecture.").removeClass("upload").addClass("error")}},true);a.addEventListener("progress",function(e){if(e.lengthComputable){c.html("Chargement : "+Math.round((e.loaded*100)/e.total)+"%")}},true);a.addEventListener("loadProgress",function(e){if(e.lengthComputable){c.html("Chargement : "+Math.round((e.loaded*100)/e.total)+"%")}},true)}else{a.onload=function(){var e=new XMLHttpRequest();e.open("POST","ajax/manageCover.php?up=true&rel="+b,true);e.setRequestHeader("UP-NAME","upload");e.setRequestHeader("UP-FILENAME",d.name);e.setRequestHeader("UP-SIZE",d.size);e.setRequestHeader("UP-TYPE",d.type);e.send(window.btoa(a.result));c.addClass("upload");e.onload=function(){if(e.readyState==4){c.removeClass("upload");if(e.status==200){c.html(c.data("oldText")).addClass("valid");var f=new Date().getTime();$("#editPreview").empty().append($("<img>",{src:"covers/"+d.name+"?"+f}));$("#"+b+"Cover").val(d.name);if(!$("#previewShow:checked").length){$("#previewShow").click()}}else{c.html(e.responseText).addClass("error")}}}}}a.readAsBinaryString(d)}else{c.removeClass("upload").addClass("error");inform("upload non support√©","error")}}function checkField(b){var a=$(b.target);if(a[0].validity){if(a[0].validity.valid){if(a.val()!=""){a.removeClass("required error upload").addClass("valid")}}else{if(b.type!="input"){if(a[0].validity.valueMissing){a.removeClass("error valid upload").addClass("required")}else{a.removeClass("required valid upload").addClass("error")}}else{if(a[0].validity.valueMissing){a.removeClass("required valid error upload")}}}}}var didScroll=false,interval=null;function getList(e){hideInform();var a=$("#nav");if(!a.length){return}if(a.data("updating")!=1){a.data("updating",1);var d=$("#nav").data("activeTab");if(d===undefined){return}var c=d.charAt(0).toUpperCase()+d.substr(1),b=$("#list_"+d),g=$("#"+d+"_filter"),f=$("body");if(!$("#"+d+"PaginateTemplate").data("tmpl")){$("#"+d+"PaginateTemplate").template(d+"Paginate")}if(!$("#"+d+"ListTemplate").data("tmpl")){$("#"+d+"ListTemplate").template(d+"List")}f.css("cursor","progress");$.ajax({url:"ajax/manage"+c+".php",data:"action="+(e==3?"more":"list&type="+e+"&"+$(":input",g).serialize()),type:"POST",dataType:"json",complete:function(){a.data("updating",0);f.css("cursor","")},success:function(n){if(e==0){$(window).scrollTop(0)}if(e!=3){b.children(".paginate, .listContent").remove();$.tmpl(d+"Paginate",n).appendTo(b);$.tmpl(d+"List",n).appendTo(b);if($.browser.mozilla&&!b.hasClass("hasCovers")&&!b.hasClass("rendered")){}b.children(".listContent").render();var m=b.children(".paginate");if(m.hasClass("begin")){if(interval){clearInterval(interval)}$(window).unbind("scroll").scroll(function(i){didScroll=true});interval=setInterval(function(){if(didScroll){didScroll=false;var i=b.find(".item:last");if(i.length&&!$("#detailShow:checked, #editShow:checked").length&&($(window).scrollTop()+$(window).height()+50)>=i.offset().top){getList(3)}}},250)}else{if(m.hasClass("end")){$(window).unbind("scroll");clearInterval(interval)}}if(e==2&&$("#detailShow:checked").length){$("#detailHide").click();var j=$("#detailBox");if(j.data("link")&&j.data("tab")==d){var o=j.data("link");var p=new Date().getTime();if(d!="storage"){var k=b.find(".detail[href="+o+"]")}else{var k=b.find(".storage[href="+o+"]")}var p=new Date().getTime(),q=k.parent().find(".cover"),h=q.attr("src")+"&ts="+p;q.removeAttr("src").attr("src",h);k.parent().css("background-image","url("+h+")");k.click()}}g.children(".listFilter.deploy").find("datalist, select").loadList()}else{b.children(".paginate").remove();$.tmpl(d+"Paginate",n).appendTo(b);var l=$.tmpl(d+"List",n);b.children(".listContent").append(l.children()).render("relayout");if(b.children(".paginate").hasClass("end")){$(window).unbind("scroll")}}}})}};